{
    "collab_server" : "",
    "contents" : "library(tidyverse)\nlibrary(RNHANES)\nlibrary(ggsci)\nlibrary(Hmisc)\nlibrary(ggthemes)\n\nd05 <- nhanes_load_data(\"BMX_D\", \"2005-2006\") %>% \n  transmute(SEQN=SEQN, BMXBMI=BMXBMI, wave=cycle) %>% \n  left_join(nhanes_load_data(\"DEMO_D\", \"2005-2006\"), by=\"SEQN\") %>% \n  select(SEQN, BMXBMI, RIDAGEYR, RIAGENDR, wave, RIDEXPRG, WTINT2YR)\n\nd07 <- nhanes_load_data(\"BMX_E\", \"2007-2008\") %>% \n  transmute(SEQN=SEQN, BMXBMI=BMXBMI, wave=cycle) %>% \n  left_join(nhanes_load_data(\"DEMO_E\", \"2007-2008\"), by=\"SEQN\") %>% \n  select(SEQN, BMXBMI, RIDAGEYR, RIAGENDR, wave, RIDEXPRG, WTINT2YR)\n\nd09 <- nhanes_load_data(\"BMX_F\", \"2009-2010\") %>% \n  transmute(SEQN=SEQN, BMXBMI=BMXBMI, wave=cycle) %>% \n  left_join(nhanes_load_data(\"DEMO_F\", \"2009-2010\"), by=\"SEQN\") %>% \n  select(SEQN, BMXBMI, RIDAGEYR, RIAGENDR, wave, RIDEXPRG, WTINT2YR)\n\nd11 <- nhanes_load_data(\"BMX_G\", \"2011-2012\") %>% \n  transmute(SEQN=SEQN, BMXBMI=BMXBMI, wave=cycle) %>% \n  left_join(nhanes_load_data(\"DEMO_G\", \"2011-2012\"), by=\"SEQN\") %>% \n  select(SEQN, BMXBMI, RIDAGEYR, RIAGENDR, wave, RIDEXPRG, WTINT2YR)\n\nd13 <- nhanes_load_data(\"BMX_H\", \"2013-2014\") %>% \n  transmute(SEQN=SEQN, BMXBMI=BMXBMI, wave=cycle) %>% \n  left_join(nhanes_load_data(\"DEMO_H\", \"2013-2014\"), by=\"SEQN\") %>% \n  select(SEQN, BMXBMI, RIDAGEYR, RIAGENDR, RIDRETH3, wave, RIDEXPRG, WTINT2YR)\n\ndat = bind_rows(d05,d07,d09,d11,d13)\n\nclean_dat = dat %>%\n            filter(!is.na(BMXBMI), RIDAGEYR >= 20, (RIDEXPRG != 1 | is.na(RIDEXPRG)))%>%\n            mutate(\n              age_group = case_when(\n                RIDAGEYR >= 20 & RIDAGEYR < 40 ~ '20-39',\n                RIDAGEYR >= 40 & RIDAGEYR < 60 ~ '40-59',\n                RIDAGEYR >= 60 ~ \"60+\"\n              ),\n              age_group = as.factor(age_group),\n              race = recode_factor(RIDRETH3, \n                                   `1` = \"Hispanic\", \n                                   `2` = \"Hispanic\", \n                                   `3` = \"Non-Hispanic, White\", \n                                   `4` = \"Non-Hispanic, Black\", \n                                   `6` = \"Non-Hispanic, Asian\",\n                                   `7` = \"Others\"),\n              gender = recode_factor(RIAGENDR, \n                                     `1` = \"Men\", \n                                     `2` = \"Women\")\n            )\n\nclean_dat %>% slice(1:5)\n\nclean_dat %>% \n             filter(wave == '2013-2014') %>%\n             group_by(age_group,gender) %>%\n             tally()\n\nmen = clean_dat %>% \n  filter(gender == \"Men\") %>% \n  group_by(wave) %>% \n  summarise(\n    \"5%\" = wtd.quantile(BMXBMI, WTINT2YR, probs=c(.05)),\n    \"10%\" = wtd.quantile(BMXBMI, WTINT2YR, probs=c(.1)),\n    \"25%\" = wtd.quantile(BMXBMI, WTINT2YR, probs=c(.25)),\n    \"50%\" = wtd.quantile(BMXBMI, WTINT2YR, probs=c(.5)),\n    \"75%\" = wtd.quantile(BMXBMI, WTINT2YR, probs=c(.75)),\n    \"90%\" = wtd.quantile(BMXBMI, WTINT2YR, probs=c(.90)),\n    \"95%\" = wtd.quantile(BMXBMI, WTINT2YR, probs=c(.95))\n  ) %>% \n  gather(\"%\", bmi, -wave)\n\nmen %>% \n  slice(1:5)\n\nwomen = clean_dat %>% \n  filter(gender == \"Women\") %>% \n  group_by(wave) %>% \n  summarise(\n    \"5%\" = wtd.quantile(BMXBMI, WTINT2YR, probs=c(.05)),\n    \"10%\" = wtd.quantile(BMXBMI, WTINT2YR, probs=c(.1)),\n    \"25%\" = wtd.quantile(BMXBMI, WTINT2YR, probs=c(.25)),\n    \"50%\" = wtd.quantile(BMXBMI, WTINT2YR, probs=c(.5)),\n    \"75%\" = wtd.quantile(BMXBMI, WTINT2YR, probs=c(.75)),\n    \"90%\" = wtd.quantile(BMXBMI, WTINT2YR, probs=c(.90)),\n    \"95%\" = wtd.quantile(BMXBMI, WTINT2YR, probs=c(.95))\n  ) %>% \n  gather(\"%\", bmi, -wave)\n\nas.list(men %>% filter(wave == \"2013-2014\") %>% select(bmi))\n\nggplot(men, aes(wave, bmi, fill = `%`, group = `%`)) +\n  geom_line(color = \"black\", size = 0.3) +\n  geom_point(colour=\"black\", pch=21, size = 3) +\n  scale_fill_jama() +\n  theme_hc() +\n  theme(text = element_text(family = \"serif\", size = 11), legend.position=\"none\") +\n  labs(\n    title = \"Weighted Percentiles of Body Mass Index by Survey Cycle\",\n    subtitle = \"Men\",\n    caption = \"Source: NHANES 2005-2014 survey\",\n    x = \"Survey Cycle Years\",\n    y = \"Body Mass Index\"\n  ) +\n  scale_y_continuous(limits=c(15,45), breaks=seq(15,45, by = 5)) +\n  annotate(\"text\", \n           x = \"2013-2014\", \n           y = c(20.7, 22.0, 24.8, 27.8, 31.9, 36.2, 40.3), \n           label = c(\" 5%\", \"10%\", \"25%\", \"50%\", \"75%\", \"90%\", \"95%\"), \n           hjust = -0.5, colour = \"#444444\", size = 3)\n\nas.list(women %>% filter(wave == \"2013-2014\") %>% select(bmi))\n\nggplot(women, aes(wave, bmi, fill = `%`, group = `%`)) +\n  geom_line(color = \"black\", size = 0.3) +\n  geom_point(colour=\"black\", pch=21, size = 3) +\n  scale_fill_jama() +\n  theme_hc() +\n  theme(text = element_text(family = \"serif\", size = 11), legend.position=\"none\") +\n  labs(\n    title = \"Weighted Percentiles of Body Mass Index by Survey Cycle\",\n    subtitle = \"Women\",\n    caption = \"Source: NHANES 2005-2014 survey\",\n    x = \"Survey Cycle Years\",\n    y = \"Body Mass Index\"\n  ) +\n  scale_y_continuous(limits=c(15,45), breaks=seq(15,45, by = 5)) +\n  annotate(\"text\", \n           x = \"2013-2014\", \n           y = c(19.6, 21.1, 23.7, 28.0, 33.5, 39.8, 43.8), \n           label = c(\" 5%\", \"10%\", \"25%\", \"50%\", \"75%\", \"90%\", \"95%\"), \n           hjust = -0.5, colour = \"#444444\", size = 3)\n",
    "created" : 1547000884734.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3162626168",
    "id" : "1C8CF209",
    "lastKnownWriteTime" : 1547008298,
    "last_content_update" : 1547008298604,
    "path" : "~/R_Projects/interestingR/Rfile/201801/0109_analysis_visualization_in_R_tidyverse.R",
    "project_path" : "Rfile/201801/0109_analysis_visualization_in_R_tidyverse.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 10,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}